import sys
import heapq

def solve() :
    N = int(sys.stdin.readline())
    pq = []
    grid = []
    for _ in range(N) :
        grid.append(list(sys.stdin.readline()))
        for c in range(N) :
            if grid[-1][c] == '#' and len(pq) == 0 :
                for i in range(0, 4) : pq.append((0, len(grid)-1, c, i))
    
    steps = ((0, 1), (1, 0), (0, -1), (-1, 0)) # direct address <= cur_direct
    visited = [[ False for _ in range(N)] for _ in range(N)]
    while pq :
        cur_cost, cur_row, cur_col, cur_direct = heapq.heappop(pq)
        next_row, next_col = cur_row + steps[cur_direct][0], cur_col + steps[cur_direct][1]
        while (0<= next_row < N) and (0<=next_col<N) and grid[next_row][next_col] != '*' :
            if not visited[next_row][next_col] :
                if grid[next_row][next_col] == '#':
                    print(cur_cost)
                    return
                elif grid[next_row][next_col] == '!':
                    visited[next_row][next_col] = True
                    heapq.heappush(pq, (cur_cost + 1, next_row, next_col, (cur_direct - 1 + 4) % 4))
                    heapq.heappush(pq, (cur_cost + 1, next_row, next_col, (cur_direct + 1) % 4))
            next_row += steps[cur_direct][0]
            next_col += steps[cur_direct][1]
    return
solve()

'''
5
#...!
.....
****.
!..#.
!...!

5
#****
!!***
*!!**
**!!*
***!#

5
#!!!.
!*!!!
!***!
!*!!!
.!**#

50
#!..............................................*!
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
.!...............................................!
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
.*...........................................!...!
.!.......................!...................!...*
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
..................................................
*................................................*
!!...............................................#
Answer: 8
    
50
**************************************************
#!*............................................*!#
*!!..............................................*
*.!!.............................................*
*..!!............................................*
*...!!...........................................*
*....!!..........................................*
*.....!!.........................................*
*......!!........................................*
*.......!!.......................................*
*........!!......................................*
*.........!!.....................................*
*..........!!....................................*
*...........!!...................................*
*............!!..................................*
*.............!!.................................*
*..............!!................................*
*...............!!...............................*
*................!!..............................*
*.................!!.............................*
*..................!!............................*
*...................!!...........................*
*....................!!..........................*
*.....................!!.........................*
*......................!!........................*
*.......................!!.......................*
*........................!!......................*
*.........................!!.....................*
*..........................!!....................*
*...........................!!...................*
*............................!!..................*
*.............................!!.................*
*..............................!!................*
*...............................!!...............*
*................................!!..............*
*.................................!!.............*
*..................................!!............*
*...................................!!...........*
*....................................!!..........*
*.....................................!!.........*
*......................................!!........*
*.......................................!!.......*
*........................................!!......*
*.........................................!!.....*
*..........................................!!....*
*...........................................!!...*
*............................................!!..*
*.............................................!!.*
*..............................................!!*
**************************************************

'''